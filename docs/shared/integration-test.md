# SSMO 統合テスト チェックリスト

> 全マイルストーンの動作確認用。ParrelSync 2人接続でテスト。
> 問題があればメモ欄に記録 → バグ修正タスクとしてBACKLOGに追加。
> 新マイルストーン完了時にセクションを追加していく。

---

## テスト環境
- Host + ParrelSync Clone（2人接続）
- Unity Editor上で実行
- デバッグキー: F1-F12, T（DebugTestHelper）

---

## M1: ネットワーク同期基盤

### 接続
- [x] Host起動が正常に完了する ✅M1確認済
- [x] Clone側でClient接続が成功する ✅M1確認済
- [x] 接続後にプレイヤーキャラ（箱人間）がスポーンする ✅M1確認済
- [x] NetworkStatsHUD（左上）にRTT/PacketLossが表示される ✅M1確認済

### 移動同期
- [x] WASD移動が両プレイヤーで正しく同期される ✅M1確認済
- [ ] 相手プレイヤーの動きがスムーズに見える（補間）⚠クライアント側ジッター報告あり
- [ ] 急に方向転換してもワープしない（クライアント予測）

### カメラ
- [ ] 3人称カメラが自キャラを追従する
- [ ] マウスでカメラ回転できる
- [ ] 壁にカメラがめり込まない（壁衝突回避）

---

## M2: 戦闘アクション

### 通常攻撃コンボ
- [x] N1→N2→N3→N4 が連鎖する ✅統合テスト確認済（J連打）
- [ ] コンボ受付ウィンドウ（モーション最後30%）で次段入力可能
- [ ] 先行入力バッファ（150ms）が機能する
- [ ] コンボ中に方向転換可能（スティック入力）
- [ ] コンボ途中で入力やめるとIdleに戻る

### チャージ攻撃
- [x] C1（K単体）が発動する ✅統合テスト確認済
- [x] N1→K で C2（打ち上げ）が発動する ✅統合テスト確認済
- [x] N1→N2→K で C3（ラッシュ）が発動する ✅統合テスト確認済
- [x] C3中にK連打でラッシュ追加ヒットが出る ✅統合テスト確認済
- [x] N1→N2→N3→K で C4（吹き飛ばし）が発動する ✅統合テスト確認済
- [ ] 最終段（N4）からはチャージ派生不可

### ダッシュ攻撃
- [x] 1.5秒以上移動後にJでダッシュ攻撃が発動する ✅統合テスト確認済
- [x] ダッシュ攻撃→J連打でダッシュラッシュが出る ✅統合テスト確認済
- [ ] ダッシュ攻撃はNコンボとは別系統（N移行しない）

### ジャンプ
- [x] N/./Spaceキーでジャンプする ✅統合テスト確認済（Space追加済み）
- [ ] 方向+N/.で斜めジャンプする
- [ ] ジャンプ中は方向転換不可
- [x] ジャンプ中Jでジャンプ攻撃（JA）が発動する ✅統合テスト確認済
- [x] ジャンプ中Kでジャンプチャージ（JC）が発動する ✅統合テスト確認済
- [ ] 2段ジャンプ不可
- [ ] ジャンプ中ガード不可

### ヒット判定
- [x] 攻撃が相手にヒットする（サーバー権威） ✅統合テスト確認済
- [x] ヒット時にダメージが適用される ✅統合テスト確認済
- [ ] フレンドリーファイア無効（味方には当たらない）
- [ ] ラグコンペンセーションが機能する

### 被弾リアクション
- [ ] のけぞり（ヒットスタン）が発生する
- [ ] F7: 相手をヒットスタントグルで確認
- [x] C2ヒットで打ち上げが起きる ✅統合テスト確認済
- [ ] F9: 打ち上げ（Launch）が発生する
- [x] C4ヒットで吹き飛ばしが起きる ✅統合テスト確認済
- [ ] 空中被弾でダメージ÷2（空中補正）
- [ ] 4種ダウン: 前のめり / 崩れ落ち / 仰向け / 気絶

### ダメージ計算
- [ ] HP青帯（50-100%）で等倍ダメージ
- [ ] HP黄帯（20-50%）でダメージ÷1.5（根性補正）
- [ ] HP赤帯（0-20%）でダメージ÷2（根性補正）
- [ ] F4: HPを20%に設定して根性補正テスト

### ガード
- [x] U/O/LShift（L1）押しっぱなしでガード状態になる ✅統合テスト確認済
- [x] 正面からの攻撃を完全カット（0ダメージ） ✅統合テスト確認済
- [ ] 通常ガード時にノックバックが発生する
- [x] ガード移動（U/O/LShift+WASD）ができる ✅統合テスト確認済
- [ ] 無双乱舞もガードできる
- [x] F5: 相手をガード状態に強制トグル ✅統合テスト確認済
- [x] めくり（背面攻撃）でガードを崩せる ✅統合テスト確認済
- [x] F1: 相手を正面2mに移動 ✅統合テスト確認済
- [x] F6: 相手を背面2mに移動（めくりテスト） ✅統合テスト確認済

### エレメンタルガード (EG)
- [ ] ガード中に△約1秒押し込みでEG準備→完成
- [x] EG完成中に攻撃を受けるとカウンター発動 ✅統合テスト確認済
- [ ] EGカウンターで攻撃者が吹き飛ぶ
- [ ] EG中はノックバックなし
- [ ] EG維持中に無双ゲージが減少する
- [ ] 無双ゲージ0でEG解除
- [x] F8: 相手をEG展開トグル ✅統合テスト確認済

### 無双乱舞
- [x] F3: 無双ゲージをMAXにする ✅統合テスト確認済
- [x] ゲージMAXでL押しで無双乱舞発動 ✅統合テスト確認済
- [ ] 無双乱舞中は無敵
- [ ] 無双乱舞はガード可能（めくりでのみ通る）
- [x] F4でHP20%→無双発動で真・無双乱舞になる ✅統合テスト確認済
- [ ] 真・無双乱舞に炎属性が付与される
- [ ] のけぞり中に無双で脱出可能
- [ ] ゲージ非MAX時に○長押しで無双チャージ（その場停止）

### アーマーシステム
- [x] F10: 相手のアーマー段階を変更 ✅統合テスト確認済
- [ ] アーマーNone（段階1）: 全攻撃でのけぞる
- [x] N耐性（段階3）: 通常攻撃(J)でのけぞらない ✅統合テスト確認済
- [x] N耐性（段階3）: C4で吹き飛ぶ ✅統合テスト確認済
- [x] SA（段階4）: チャージ攻撃(C4)でものけぞらない ✅統合テスト確認済
- [ ] アーマーがあってもダメージは通る

### HP・死亡・リスポーン
- [x] HPが0で Dead ステートになる ✅統合テスト確認済
- [ ] 即リスポーンする（待ち時間なし）
- [ ] リスポーン時にHP全回復 + 無双ゲージMAX
- [x] F2: 全員のHP全回復 + Dead復活 ✅統合テスト確認済
- [ ] Dead状態のキャラに攻撃が当たらない（死体蹴り不可）
- [ ] リスポーン後3秒間は無敵状態になる（スポーン無敵）
- [ ] スポーン無敵中に攻撃すると無敵が解除される

### デバッグキー
- [x] F1: 相手を正面2mに移動 ✅統合テスト確認済
- [x] F2: 全員HP全回復 + Dead復活 ✅統合テスト確認済
- [x] F3: 無双ゲージMAX ✅統合テスト確認済
- [x] F4: HP20%設定 ✅統合テスト確認済
- [x] F5: ガードトグル ✅統合テスト確認済
- [x] F6: 背面移動（めくり） ✅統合テスト確認済
- [x] F7: Hitstunトグル ✅統合テスト確認済（ステート変更確認）
- [x] F8: EG展開トグル ✅統合テスト確認済
- [x] F9: Launchトグル ✅統合テスト確認済（ステート変更確認）
- [x] F10: アーマー段階変更 ✅統合テスト確認済
- [x] T: 俯瞰フリーカメラ ✅統合テスト確認済

---

## M3: 4v4 対戦モード

### チーム管理 (TeamManager)
- [ ] 2人が赤/青の別チームに振り分けられる
- [ ] チーム色が見た目で区別できる

### スポーン (SpawnManager)
- [ ] 各プレイヤーが自チーム側のスポーン地点に配置される
- [ ] リスポーン地点が交互に変わる（同じ拠点に連続しない）

### マップ (MapGenerator)
- [x] 100m×100m の地面が生成される ✅統合テスト確認済（Sceneビューで確認）
- [ ] 外壁（見えない壁）が機能する
- [x] 拠点5個（中央1 + 赤2 + 青2）が色分けで表示される ✅統合テスト確認済（Sceneビューで確認）
- [x] 障害物が配置される ✅統合テスト確認済（Sceneビューで確認）

### 拠点 (BasePoint)
- [ ] 拠点エリア内に入ると制圧ゲージが動く
- [ ] 自軍拠点内でHP自動回復が発動する
- [ ] 拠点の所属チームが変わる（Neutral→Red/Blue）

### NPC兵士 (NPCSoldier / NPCSpawner)
- [x] 拠点から定期的にNPC兵士がスポーンする ✅統合テスト確認済（Consoleログ確認）
- [ ] NPC兵士がチーム色で区別できる
- [ ] NPC兵士が敵に向かって移動する
- [x] NPC兵士が攻撃範囲内で攻撃する ✅統合テスト確認済（NPC-ATKログ確認）
- [ ] NPC兵士を倒せる（ダメージが通る）
- [ ] NPC兵士のガード判定が機能する

### 仙箪 (SentanItem)
- [x] NPC兵士死亡時に仙箪（金色の球）がドロップする ✅統合テスト確認済（仙箪ドロップログ確認）
- [ ] 仙箪を拾える（近づくと自動取得）
- [ ] 仙箪カウントが増える
- [ ] 30秒経過で未取得の仙箪が消える

### UI - BattleHUD
- [ ] 画面下部に自キャラHPバーが表示される
- [ ] HPバーの色変化（青→黄→赤）が正しい
- [ ] 無双ゲージバーが表示される
- [ ] 無双ゲージMAX時に金色になる
- [ ] ターゲットHP（攻撃した敵）が画面上部に表示される
- [ ] NPC兵士のHPもターゲット表示される

### UI - MinimapHUD
- [ ] 画面右下にミニマップが表示される
- [ ] 自分（白）・味方（青）・敵（赤）のドットが表示される
- [ ] 拠点の所属チーム色（赤/青/灰）が表示される
- [ ] Mキーで全体マップ⇔ミニマップ切替が動作する

### UI - ScoreboardHUD
- [ ] 画面上部中央に残り時間タイマーが表示される
- [ ] タイマー左右に赤チーム撃破数 vs 青チーム撃破数が表示される
- [ ] プレイヤーを倒すとスコアが増える
- [ ] 試合終了時に勝敗テキストが表示される（VICTORY!/DEFEAT/DRAW）

### ゲームモード (GameModeManager)
- [ ] MIN_PLAYERS_TO_START（2人）で試合開始する
- [x] 5分タイマーがカウントダウンする ✅統合テスト確認済
- [x] タイマー0で試合終了する（DRAW表示確認） ✅統合テスト確認済
- [ ] 撃破数で勝敗が決まる

---

## M4: キャラクター＆コンテンツ（テスト追加用）

### 武器種 (WeaponData)
- [ ] 武器種ごとに移動速度が異なる
- [ ] 武器種ごとに攻撃リーチが異なる
- [ ] 武器種ごとにモーション倍率が異なる
- [ ] 武器種ごとにヒットボックスサイズが異なる

### 属性システム (ElementSystem)
- [ ] チャージ攻撃にのみ属性が乗る（通常攻撃には乗らない）
- [ ] 炎: 燃焼（持続ダメージ、HP0にはしない）
- [ ] 氷: 凍結（確率発動、約2秒行動不能）
- [ ] 雷: 感電（受け身不可）+ 気絶（地上のみ約3秒）
- [ ] 風: 鈍足（移動低下+ジャンプ不可）
- [ ] 斬: 防御無視 + HP&無双両方にダメージ

### 連撃強化 (ComboSystem)
- [ ] 連撃強化1回: N5 解放
- [ ] 連撃強化2回: N6 解放
- [ ] 連撃強化3回 + 無双MAX: エボリューション E6-E9

### 仙箪強化リング (EnhancementRing)
- [ ] 仙箪7個でリング回転開始
- [ ] R1（Iキー）でスロット発動
- [ ] 連撃強化スロットでコンボ段数増加
- [ ] ATKバフスロットで攻撃力+10%
- [ ] DEFバフスロットで防御力+10%
- [ ] 死亡時に全強化リセット（仙箪カウントは維持）

### 鍛錬システム (TrainingSystem)
- [ ] 鍛錬ポイント振り分けでATKが増加する
- [ ] 鍛錬ポイント振り分けでDEFが増加する
- [ ] 鍛錬ポイント振り分けでHPが増加する
- [ ] 三角数コスト（1段目=1, 2段目=3, 3段目=6...）が正しい
- [ ] ポイント上限（24）を超える振り分けが不可

### 刻印システム (ComboSystem)
- [ ] C1刻印設定でC1モーション倍率が変わる（突/陣/砕/盾）
- [ ] C6刻印設定でC6モーション倍率が変わる（突/陣/砕/盾/覇/衛）
- [ ] 刻印C1のヒットボックスが刻印種別に応じて変わる

### 究極強化 (UltimateEnhancement)
- [ ] 究極強化発動で30秒バフが適用される
- [ ] 究極強化中にATK×1.5が適用される
- [ ] 究極強化中にDEF×1.5が適用される
- [ ] 究極強化中に移動速度×1.2が適用される
- [ ] 究極強化中にアーマーレベル+1される
- [ ] 30秒経過で究極強化が自動解除される
- [ ] 死亡時に究極強化がリセットされる

### ブレイクチャージ (ComboSystem)
- [x] H（L2）でブレイクチャージ（BC）が発動する ✅統合テスト確認済
- [x] ダッシュ中HでDBC（ダッシュブレイクチャージ）が発動する ✅統合テスト確認済
- [x] 空中でHでJBC（ジャンプブレイクチャージ）が発動する ✅統合テスト確認済
- [ ] 連続BC（2秒以内）でブレイクラッシュスタックが増加する
- [ ] スタック最大5でATK+50%ボーナス
- [ ] BC中は武器2のヒットボックスが使用される

---

## デバッグキー早見表（使用頻度順に再配置済み）

| キー | 機能 |
|------|------|
| F1 | 相手を正面2mに瞬間移動 |
| F2 | 全員HP全回復 + Dead復活 |
| F3 | 自分の無双ゲージ MAX |
| F4 | 自分のHPを20%に設定（真無双テスト用） |
| F5 | 相手にガード状態を強制トグル |
| F6 | 相手を背面2mに移動（めくりテスト用） |
| F7 | 相手を Hitstun トグル |
| F8 | 相手を EG展開トグル（強制維持+ゲージ補充） |
| F9 | 相手を Launch トグル |
| F10 | 相手のアーマー段階+1（ループ） |
| F11 | 自分の武器2を変更（ループ） |
| F12 | GUI表示トグル |
| T | 俯瞰フリーカメラ トグル |

---

## M5: インフラ＆チート対策

### 認証 (AuthManager)
- [ ] アプリ起動時に匿名認証が成功する
- [ ] 認証完了前にHost/Client接続ボタンが無効化される
- [ ] 認証タイムアウト時にエラー表示される

### データ保存 (PlayerDataManager)
- [ ] 戦闘開始時にFirestoreからプレイヤーデータが読み込まれる
- [ ] 戦闘終了時に戦績が更新される
- [ ] 武器種・属性設定が正しく反映される

### Relay接続 (RelayManager)
- [ ] ホストがRelay経由で部屋を作成できる
- [ ] JoinCodeが表示される
- [ ] クライアントがJoinCodeで参加できる
- [ ] NAT越え環境で接続できる（別ネットワークの2台）

### ロビー (LobbyManager)
- [ ] ロビー作成ができる
- [ ] ロビー一覧が表示される
- [ ] ロビーに参加できる
- [ ] チーム選択（赤/青）ができる
- [ ] Ready状態が同期される
- [ ] 全員Readyでゲームが開始される
- [ ] ハートビートが送信される（ロビーが消えない）

### チート対策 (AntiCheat)
- [ ] 速度チェック: 異常な移動速度が補正される
- [ ] 入力レートチェック: 高頻度入力が無視される
- [ ] コンボ不正チェック: 段数飛ばしが拒否される
- [ ] 距離チェック: リーチ外のヒットが無効化される
- [ ] 違反累積でキックされる

### サーバーログ (ServerLogger)
- [ ] ログファイルが server_logs/ に生成される
- [ ] プレイヤー接続/切断がログに記録される
- [ ] 撃破ログが記録される
- [ ] 試合結果サマリーが記録される

---

## M6: ポリッシュ＆α版リリース

### アニメーション (AnimationController)
- [ ] モデルが表示される（箱人間ではない）
- [ ] 移動アニメーションが再生される
- [ ] 攻撃アニメーションが各段で再生される
- [ ] 被弾リアクションのアニメーションが再生される
- [ ] ガード/EGのアニメーションが再生される
- [ ] 他プレイヤーのアニメーションが同期表示される

### エフェクト (EffectManager)
- [ ] ヒット時にエフェクトが表示される
- [ ] 属性エフェクト（炎/氷/雷/風/斬）が区別できる
- [ ] EGカウンターのエフェクトが表示される
- [ ] 無双発動のエフェクトが表示される

### サウンド (SoundManager)
- [ ] 攻撃SE・ヒットSEが再生される
- [ ] ガード/EG/無双のSEが再生される
- [ ] BGMが再生される
- [ ] 音量調整が機能する

### UI (uGUI)
- [ ] HPバーがuGUIで表示される（色変化あり）
- [ ] 無双ゲージがuGUIで表示される
- [ ] ミニマップがuGUIで表示される
- [ ] スコアボードがuGUIで表示される
- [ ] ダメージ数字がポップアップ表示される
- [ ] キルログが表示される

### マップ
- [ ] テクスチャ付きの地面が表示される
- [ ] 拠点が視覚的に区別できる
- [ ] 障害物が戦略的に配置されている
- [ ] カメラの壁貫通回避が新障害物でも機能する

### バランス
- [ ] 各武器種が対戦で使い物になる（極端な強弱がない）
- [ ] 試合が5分で決着する
- [ ] 仙箪が適度な頻度でドロップする

---

## バグ報告メモ

### バグ #1 ✅修正済
```
日時: 2026-02-25
マイルストーン: M3
重要度: 高
症状: 地面の MeshCollider が薄すぎて CharacterController が落下する
再現手順: Host起動 → プレイヤースポーン → 地面をすり抜けて落下
修正: MapGenerator で Plane の MeshCollider → BoxCollider(厚み0.1) に置換
```

### バグ #2 ✅修正済
```
日時: 2026-02-25
マイルストーン: M3
重要度: 高
症状: スポーン位置が原点(0,0,0)になり SpawnManager の位置が反映されない
再現手順: Host起動 → [Spawn]ログでY=0を確認 → 地面から落下
修正: PlayerMovement.OnNetworkSpawn() でサーバー側が SpawnManager.GetSpawnPosition() を呼び出しテレポート
```

### バグ #3 ✅修正済
```
日時: 2026-02-25
マイルストーン: M2
重要度: 高
症状: ジャンプ中に□/△を押すとJA/JCではなくN1/C1（地上攻撃）が出る
再現手順: ジャンプ → 空中でJ(□) → N1が発生（JumpAttackステートにならない）
修正: PlayerMovement の _isJumping 分岐追加 + ComboSystem に TryStartJumpAttack/TryStartJumpCharge 追加
```

### バグ #4
```
日時: 2026-02-25
マイルストーン: M1
重要度: 中
症状: クライアント側で相手プレイヤーの動きにジッターが発生する
再現手順: Host+Clone接続 → Clone側で相手の動きを観察 → 不規則にカクつく
備考: 補間パラメータ調整またはスナップ閾値見直しで改善する可能性
```

### バグ #5
```
日時: 2026-02-25
マイルストーン: M2
重要度: 中
症状: EGがHP0（Dead状態）でも発動する
再現手順: 相手を倒す → F8でEGトグル → Dead状態でEG発動
備考: EG発動前にDead状態チェックが必要
```
